"use strict";!function($){var obj,checkCan=new Array,patterns=new Object;patterns.Ip=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])(\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])){3}$/,patterns.Email=/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/,patterns.Date=/^\d{4}-(0?[1-9]|1[0-2])-(0?[1-9]|[1-2]\d|3[0-1])$/,patterns.Time=new RegExp("^([0-1]\\d|2[0-3]):[0-5]\\d:[0-5]\\d$"),patterns.Num=/^[0-9]*$/,patterns.FloatNum=/^\d+(\.\d+)?$/,patterns.DateAndTime=/^(?:19|20)[0-9][0-9]-(?:(?:0[1-9])|(?:1[0-2]))-(?:(?:[0-2][1-9])|(?:[1-3][0-1])) (?:(?:[0-2][0-3])|(?:[0-1][0-9])):[0-5][0-9](:[0-5][0-9])?$/,patterns.Phone=/^(1[3|4|5|8])[0-9]{9}$/,patterns.Chinese=/^[\u4e00-\u9fa5]{2,8}$/,patterns.QQ=new RegExp("^[1-9]\\d{4,10}$"),patterns.Telephone=/^((0\d{2,3})-)(\d{7,8})(-(\d{3,}))?$/,patterns.isIDCard1=/^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$/,patterns.isIDCard2=/^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/;var bind_form_check=function bind_form_check(){$(".form_check").after('<div class=" show_info" ></div>'),$(".form_check").click(function(){}),$(".form_check").focus(function(){}),$(".form_check").blur(function(){obj=$(this);var type=obj.attr("check-type"),checkLength=checkInputLength();if(0!=checkLength.status){var check=eval("check"+type+"()");obj.attr("check-url")||showInfo(check.info,check.status)}else showInfo(checkLength.info,checkLength.status)}),$(".form_check").change(function(){$(this).blur()}),$(":submit").click(function(t){var e=!0;for(var n in checkCan)e&=checkCan[n];if(!e)return toast.error("请填写完整且正确的信息后再提交！"),t.preventDefault(),!1})},checkEmpty=function(){return 0!=obj.val().length},checkInputLength=function(){var t=obj.val().replace(/\s+/g,"");if(0==t.length)return{status:0,info:"不能为空"};if(void 0!==obj.attr("check-length")){var e=new Array;if((e=obj.attr("check-length").split(","))[1]){if("*"==e[1]){if(t.length<e[0])return{status:0,info:"字数不能少于"+e[0]+"个"}}else if(e[1]<t.length||t.length<e[0]){return{status:0,info:"要求字数为"+e[0]+"-"+e[1]+"个"}}}else if(e[0]<t.length)return{status:0,info:"字数不能少于"+e[0]+"个"}}return{status:1,info:""}},checkText=function(){return{status:1,info:""}},checkChinese=function(){var t=obj.val();if(patterns.Chinese.test(t))var e={status:1,info:""};else e={status:0,info:"请输入2-8个汉字的姓名"};return e},checkQQ=function(){var t=obj.val();if(patterns.QQ.test(t))var e={status:1,info:""};else e={status:0,info:"请输入正确qq号！"};return e},checkEmail=function(){var t=obj.val();if(patterns.Email.test(t))var e={status:1,info:""};else e={status:0,info:"请输入正确Email地址！"};return e},checkIDCard=function(){var t=obj.val();if(patterns.isIDCard1.test(t)||patterns.isIDCard2.test(t))var e={status:1,info:""};else e={status:0,info:"请输入正确身份证号！"};return e},checkDate=function(){var t=obj.val();if(patterns.Date.test(t))var e={status:1,info:""};else e={status:0,info:"请填写正确的格式！"};return e},checkDateAndTime=function(){var t=obj.val();if(patterns.DateAndTime.test(t))var e={status:1,info:""};else e={status:0,info:"请填写正确的格式！"};return e},checkNum=function(){var t=obj.val();if(patterns.Num.test(parseInt(t))){if(void 0!==obj.attr("check-value")){var e=new Array;if(e=obj.attr("check-value").split(","),t=parseInt(obj.val()),e[1]){if("*"==e[1])if(t<parseInt(e[0]))return n={status:0,info:"数字至少为"+parseInt(e[0])};if(parseInt(e[1])<t||t<parseInt(e[0]))return n={status:0,info:"数字范围在"+e+"内"}}else{if(parseInt(e[0])<t)return n={status:0,info:"数字范围在"+e+"内"}}}var n={status:1,info:""}}else n={status:0,info:"请填写数字！"};return n},checkIntNum=function(){var t=obj.val();if(parseInt(t)!=t)return n={status:0,info:"请填写整数数字！"};if(patterns.Num.test(parseInt(t))){if(void 0!==obj.attr("check-value")){var e=new Array;if(e=obj.attr("check-value").split(","),t=parseInt(obj.val()),e[1]){if("*"==e[1])if(t<parseInt(e[0]))return n={status:0,info:"数字至少为"+parseInt(e[0])};if(parseInt(e[1])<t||t<parseInt(e[0]))return n={status:0,info:"数字范围在"+e+"内"}}else{if(parseInt(e[0])<t)return n={status:0,info:"数字范围在"+e+"内"}}}var n={status:1,info:""}}else n={status:0,info:"请填写整数数字！"};return n},checkFloatNum=function(){var t=obj.val();if(parseFloat(t)!=t)return n={status:0,info:"请填写浮点型数字！"};if(patterns.FloatNum.test(parseFloat(t))){if(void 0!==obj.attr("check-value")){var e=new Array;if(e=obj.attr("check-value").split(","),t=parseFloat(obj.val()),e[1]){if("*"==e[1])if(t<parseFloat(e[0]))return n={status:0,info:"数字至少为"+parseFloat(e[0])};if(parseFloat(e[1])<t||t<parseFloat(e[0]))return n={status:0,info:"数字范围在"+e+"内"}}else{if(parseFloat(e[0])<t)return n={status:0,info:"数字范围在"+e+"内"}}}var n={status:1,info:""}}else n={status:0,info:"请填写整数数字！"};return n},checkPhoneOrTelephone=function(){var t=obj.val();if(patterns.Phone.test(parseInt(t))||patterns.Telephone.test(t))var e={status:1,info:""};else e={status:0,info:"请填写手机号码或固定电话！"};return e},checkPhone=function(){var t=obj.val();if(patterns.Phone.test(parseInt(t)))var e={status:1,info:""};else e={status:0,info:"请填写手机号码！"};return e},checkTelephone=function(){var t=obj.val();if(patterns.Telephone.test(t))var e={status:1,info:""};else e={status:0,info:"请填写固定电话号码！"};return e},checkSelect=function(){var t=obj.val();if(0==t&&1==obj.attr("can-empty"))return check_form.remove(),void(checkCan[obj.attr("name")]=1);if(0!=t&&""!=t&&void 0!==t)var e={status:1,info:""};else e={status:0,info:"请选择！"};return e},checkRegExps=function(){var t=obj.attr("reg-exp");if(void 0!==t){var e=obj.val();if((t=new RegExp(t)).test(e))var n={status:1,info:""};else n={status:0,info:obj.attr("error-info")||"请按正确格式填写！"};return n}checkCan[obj.attr("name")]=1},checkUsername=function(){var t=obj.val(),e=obj.attr("check-url");$.post(e,{account:t,type:"username"},function(t){ajaxRerurn(t)},"json")},checkUserEmail=function(){var t=obj.val(),e=obj.attr("check-url");$.post(e,{account:t,type:"email"},function(t){ajaxRerurn(t)},"json")},checkUserMobile=function(){var t=obj.val(),e=obj.attr("check-url");$.post(e,{account:t,type:"mobile"},function(t){ajaxRerurn(t)},"json")},checkNickname=function(){var t=obj.val(),e=obj.attr("check-url");$.post(e,{nickname:t},function(t){ajaxRerurn(t)},"json")},ajaxRerurn=function(t){t.status?(checkCan[obj.attr("name")]=1,check_form.success(t.info)):(checkCan[obj.attr("name")]=0,check_form.error(t.info))},showInfo=function(t,e){check_form.remove(),1==e||1==e?(check_form.success(t),check_form.remove()):check_form.error(t)},removeInfo=function(){obj.parent().find(".show_info").html("")},check_form={remove:function(){removeInfo()},error:function(t){var e;e='<div class="send red"><i class="icon-remove-sign"></i> '+t+"</div>",obj.parent().find(".show_info").html(e)},success:function(t){var e;e='<div class="send green"><i class="icon-check-circle"></i> '+t+"</div>",obj.parent().find(".show_info").html(e)}};$(document).ready(function(t){bind_form_check()})}(jQuery),$(function(){$("input,area").placeholder(),follower.bind_follow()}),$(function(){$(document).on("click",".ajax-post",function(t){t.preventDefault();var e=$(this).attr("href"),n=$(this).attr("data-confirm");if(n&&!confirm(n))return!1;$.post(e,{},function(t,e,n){handleAjax(t)})}),$(document).on("submit","form.ajax-form",function(t){t.preventDefault();var e=$(this);$("[type=submit]",e).addClass("disabled");var n=$(this).attr("action"),o=$(this).attr("method");if(!n)return!1;o||(o="get");var a=$(this).serialize();return("post"==o?$.post:$.get)(n,a,function(t){handleAjax(t),$("[type=submit]",e).removeClass("disabled")}),!1})}),$(function(){$(window).on("scroll",function(){0<$(document).scrollTop()?$("#go-top").css("display","block"):$("#go-top").hide()}),$("#tool .go-top").on("click",function(){$("html,body").animate({scrollTop:0},500)}),$("#go-top .uc-2vm").hover(function(){$("#go-top .uc-2vm-pop").removeClass("dn")},function(){$("#go-top .uc-2vm-pop").addClass("dn")})}),$(function(){$("[event-node=logout]").click(function(){$.get(U("Ucenter/System/logout"),function(t){$("body").append(t.html),toast.success(t.message+"。","温馨提示"),setTimeout(function(){location.href=t.url},1500)},"json")})});var follower={bind_follow:function(){$('[data-role="follow"]').unbind("click"),$('[data-role="follow"]').click(function(){var e=$(this),t=e.attr("data-follow-who");$.post(U("Ucenter/Public/follow"),{uid:t},function(t){t.status?(e.attr("class",e.attr("data-before")),e.attr("data-role","unfollow"),e.html("已关注"),follower.bind_follow(),toast.success(t.info,"温馨提示")):toast.error(t.info,"温馨提示")},"json")}),$('[data-role="unfollow"]').unbind("click"),$('[data-role="unfollow"]').click(function(){var e=$(this),t=e.attr("data-follow-who");$.post(U("Ucenter/Public/unfollow"),{uid:t},function(t){t.status?(e.attr("class",e.attr("data-after")),e.attr("data-role","follow"),e.html("关注"),follower.bind_follow(),toast.success(t.info,"温馨提示")):toast.error(t.info,"温馨提示")},"json")})}},upAttachVal=function(t,e,n){var o=n,a=o.val().split(","),s=[];for(var r in a)""!==a[r]&&a[r]!==e.toString()&&s.push(a[r]);return"add"===t&&s.push(e),o.val(s.join(",")),s};function is_login(){return parseInt(MID)}function U(t,e,n){if(2==window.Think.MODEL[0]){var o=_ROOT_+"/";""!=(t=t.split("/"))[0]&&"@"!=t[0]||(t[0]=APPNAME),t[1]||(t[1]="Index"),t[2]||(t[2]="index"),o=o+""+t[0]+"/"+t[1]+"/"+t[2],e&&(o=o+"/"+(e=e.join("/"))),n||(o+=".html")}else{o=_ROOT_+"/index.php";""!=(t=t.split("/"))[0]&&"@"!=t[0]||(t[0]=APPNAME),t[1]||(t[1]="Index"),t[2]||(t[2]="index"),o=o+"?s=/"+t[0]+"/"+t[1]+"/"+t[2],e&&(o=o+"/"+(e=e.join("/"))),n||(o+=".html")}return void 0!==window.Think.MODEL[1]&&(o=o.toLowerCase()),o}function playsound(t){t=""==window.Think.ROOT?"/"+t:window.Think.ROOT+"/"+t,$("embed").remove(),$("body").append('<embed src="'+t+'" autostart="true" hidden="true" loop="false">')}function friendlyDate(t,e){var n=function(t){return t<10?"0"+t:t};if(!t)return"";var o=new Date(1e3*e),a=new Date(1e3*t),s=e-t,r=parseInt(o.getDate())-parseInt(a.getDate()),i=parseInt(o.getMonth()+1)-parseInt(a.getMonth()+1),c=parseInt(o.getFullYear())-parseInt(a.getFullYear());return s<60?s<10?"刚刚":parseInt(10*Math.floor(s/10))+"秒前":s<3600?parseInt(Math.floor(s/60))+"分钟前":0===c&&0===i&&0===r?"今天"+n(a.getHours())+":"+n(a.getMinutes()):0===c?n(a.getMonth()+1)+"月"+n(a.getDate())+"日 "+n(a.getHours())+":"+n(a.getMinutes()):a.getFullYear()+"-"+n(a.getMonth()+1)+"-"+n(a.getDate())+" "+n(a.getHours())+":"+n(a.getMinutes())}function handleAjax(t){t.url&&(t.info+="，页面即将跳转～"),t.status?toast.success(t.info,"温馨提示"):toast.error(t.info,"温馨提示");"refresh"==t.url?setTimeout(function(){location.href=location.href},1500):t.url&&setTimeout(function(){location.href=t.url},1500)}!function(o,t,e){if(void 0===o)throw new Error("MUU requires jQuery");o.muu||(o.muu=function(t){o.isPlainObject(t)&&o.extend(o.muu,t)});var n=function(){o.get(U("Ucenter/Public/getInformation"),{},function(t){t.messages&&(playsound("./Public/lib/toastr/tip.mp3"),toast.info("有新消息~")),o('[data-role="now-message-num"]').html(t.message_count),0==t.message_count?o('[data-role="now-message-num"]').hide():o('[data-role="now-message-num"]').show()},"json")};var a="",s=1;o.muu({check_message:n,bind_message_checker:function(){Config.GET_INFORMATION&&setInterval(function(){n()},Config.GET_INFORMATION_INTERNAL)},init_message:function(){o('[data-role="open-slider-box"]').unbind(),o('[data-role="open-slider-box"]').click(function(){toast.showLoading(),o.post(U("Ucenter/Message/messagetypelist"),{},function(t){o("#message-type-box").find(".message-type-list").html(t),o('[data-role="open-message-list"]').first().click()}),toast.hideLoading()})},list_message:function(){o('[data-role="open-message-list"]').unbind(),o('[data-role="open-message-list"]').click(function(){a=o(this).attr("data-type"),o.post(U("Ucenter/Message/messagelist"),{tab:a},function(t){o(".message-info-list").html(t)})})},list_message_load_more:function(){o(".message-info-list").attr("data-page",1),o(".loadmore-type-messages").unbind(),o(".loadmore-type-messages").click(function(){var e=o(this);e.html("加载中"),s+=1,o.post(U("Ucenter/Message/messagelist"),{tab:a,page:s,r:10},function(t){t.length?(o(".message-info-list").append(t),e.html("加载更多")):e.html("已经没有喽")})})},send_imessage:function(){o("#iMessageAjaxPost").unbind("click"),o("#iMessageAjaxPost").click(function(){var e=o(this);e.text("发送中...");var t=o("input[name$='iMessageUid']").val(),n=o("#iMessageTxt").val();o.post(U("Ucenter/Message/postiMessage"),{iMessageUid:t,iMessageTxt:n},function(t){t.status?(toast.success(t.info,"发送成功"),e.text("发送完成")):(toast.error(t.info,"发送失败"),e.text("发送"))},"json")})}})}(jQuery,window),$(document).ready(function(t){is_login()&&($.muu.check_message(),$.muu.bind_message_checker(),$.muu.send_imessage())});var toast={success:function(t){toast.show(t,{placement:"center",type:"success",close:!0})},error:function(t){toast.show(t,{placement:"center",type:"danger",close:!0})},info:function(t){toast.show(t,{placement:"center",type:"info",close:!0})},warning:function(t,e){toast.show(t,{placement:"center",type:"warning",close:!0})},show:function(t,e){$.zui?$.zui.messager.show(t,e):$.messager.show(t,e)},showLoading:function(){$("body").append('<div class="big_loading"><img src="'+ThinkPHP.PUBLIC+'/images/big_loading.gif"/></div>')},hideLoading:function(){$("div").remove(".big_loading")}};!function(o){o(document).ready(function(){o("[ucard]").qtip({suppress:!0,content:{text:function(t,e){var n=o(this).attr("ucard");return 0!=n?(o.get(U("Ucenter/Public/card"),{uid:n},function(t){e.set("content.text",t),follower.bind_follow()}),"获取数据中..."):"获取信息失败"}},position:{viewport:o(window)},show:{solo:!0,delay:500},style:{classes:"qtip-bootstrap"},hide:{delay:500,fixed:!0}})})}(jQuery);