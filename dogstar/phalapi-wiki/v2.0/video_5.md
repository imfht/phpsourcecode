# 第五课 PhalApi 2.x 接口开发 - 接口响应与在线调试

## 视频链接
[第五课 PhalApi 2.x 接口开发 - 接口响应与在线调试](https://www.bilibili.com/video/av84041586)

[![](http://cdn7.okayapi.com/yesyesapi_20200119160508_68c28939b7bcf7179ef72041ec63cf10.png)](https://www.bilibili.com/video/av84041586)

## 1、响应结构 data-ret-msg
 + data：业务数据，推荐object类型，可以返回任意类型数据给客户端
 + ret：状态码，整型，200表示成功，4xx表示客户端非法请求，5xx表示服务器错误，其他数值可自定义（**有趣点：调试模式下可能是字符串类型**，答案：Exception 返回整型（integer）的异常代码，但在其他类中可能返回其他类型(比如在 PDOException 中返回 string)。 ）
 + msg：提示信息，字符串
 
```
# 直接返回基本类型（如：字符串）data
{"ret":200,"data":"Hello ","msg":""}

# 返回数据类型data
{"ret":200,"data":["Hello "],"msg":""}

# 返回对象类型data（推荐）
{"ret":200,"data":{"content":"Hello "},"msg":""}
``` 

延伸：
 + 1、作为一名专业的后端开发，不要只看表面，要看原始数据
 + 2、什么叫PHP的基本类型？
 
PhalApi框架的异常特点：  
 + 1、抛出的异常应该继承于PhalApi\Exception类（可以划分为：业务异常类、框架异常类 PhalApi\Exception、PHP语言异常类 \Exceptio）
 + 2、异常码，PhalApi框架异常类有一个底数
 
### 常见问题：如何允许跨域请求？ 
 + 通过header设置解决
 + 通过反向代理解决（什么叫反向代理，什么叫正向代理？）
 + 通过JSONP解决
 
### 常见问题：如何设置JSON中文输出？
 + 1、一定要特别注意：data的全部业务数据必须是UTF-8编码，才能正常JSON编码并输出
 + 2、正常情况下，中文都是可以json输出的（UTF8编码格式：\u72d7\u661f）,自 PHP 5.4.0 起生效

### 扩展：如何使用其他返回格式？

## 2、在线调试

### 开启调试模式

 + 单次请求开启调试
 + 全部请求开启调试
 
> 思考：为什么这样设计？分为单次和全部请求？

调试模式下更多的返回：  
```{
    "ret": 0,  // 异常时的错误码
    "data": [],
    "msg": "", // 异常时的错误信息
    "debug": {
        "exception": [  // 异常时的详细堆栈信息
        ],
        "stack": [  // 自定义埋点信息
        ],
        "sqls": [  // 全部执行的SQL语句
        ],
        version	"2.10.1"
    }
}
```

### 查看全部执行的SQL语句
格式：
```
[序号 - 当前SQL的执行时间ms]所执行的SQL语句及参数列表
```
> 温馨提示：也可以通过日志文件查看SQL语句。  

### 查看自定义埋点信息
在线调试、追踪执行代码路径、性能分析。  

### 查看异常堆栈信息

### 添加自定义调试信息


 
