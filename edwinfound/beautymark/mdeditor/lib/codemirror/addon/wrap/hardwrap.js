(function(m){"object"==typeof exports&&"object"==typeof module?m(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],m):m(CodeMirror)})(function(m){function p(c,a,b){for(var e=b.paragraphStart||c.getHelper(a,"paragraphStart"),d=a.line,h=c.firstLine();d>h;--d){var f=c.getLine(d);if(e&&e.test(f))break;if(!/\S/.test(f)){++d;break}}b=b.paragraphEnd||c.getHelper(a,"paragraphEnd");a=a.line+1;for(e=c.lastLine();a<=e;++a){f=c.getLine(a);if(b&&b.test(f)){++a;
break}if(!/\S/.test(f))break}return{from:d,to:a}}function v(c,a,b,e){for(var d=a;0<d&&!b.test(c.slice(d-1,d+1));--d);0==d&&(d=a);a=d;if(e)for(;" "==c.charAt(a-1);)--a;return{from:a,to:d}}function n(c,a,b,e){a=c.clipPos(a);b=c.clipPos(b);var d=e.column||80,h=e.wrapOn||/\s\S|-[^\.\d]/;e=!1!==e.killTrailingSpace;var f=[],g="",q=a.line;a=c.getRange(a,b,!1);if(!a.length)return null;b=a[0].match(/^[ \t]*/)[0];for(var r=0;r<a.length;++r){var k=a[r],n=g.length,p=0;g&&k&&!h.test(g.charAt(g.length-1)+k.charAt(0))&&
(g+=" ",p=1);var t="";r&&(t=k.match(/^\s*/)[0],k=k.slice(t.length));g+=k;if(r){var u=g.length>d&&b==t&&v(g,d,h,e);u&&u.from==n&&u.to==n+p?(g=b+k,++q):f.push({text:[p?" ":""],from:l(q,n),to:l(q+1,t.length)})}for(;g.length>d;)k=v(g,d,h,e),f.push({text:["",b],from:l(q,k.from),to:l(q,k.to)}),g=b+g.slice(k.to),++q}f.length&&c.operation(function(){for(var a=0;a<f.length;++a){var b=f[a];c.replaceRange(b.text,b.from,b.to)}});return f.length?{from:f[0].from,to:m.changeEnd(f[f.length-1])}:null}var l=m.Pos;
m.defineExtension("wrapParagraph",function(c,a){a=a||{};c||(c=this.getCursor());var b=p(this,c,a);return n(this,l(b.from,0),l(b.to-1),a)});m.commands.wrapLines=function(c){c.operation(function(){for(var a,b,e=c.listSelections(),d=c.lastLine()+1,h=e.length-1;0<=h;h--)b=e[h],b.empty()?(b=p(c,b.head,{}),a=l(b.from,0),b=l(b.to-1)):(a=b.from(),b=b.to()),b.line>=d||(d=a.line,n(c,a,b,{}))})};m.defineExtension("wrapRange",function(c,a,b){return n(this,c,a,b||{})});m.defineExtension("wrapParagraphsInRange",
function(c,a,b){b=b||{};var e=this,d=[];for(c=c.line;c<=a.line;)c=p(e,l(c,0),b),d.push(c),c=c.to;var h=!1;d.length&&e.operation(function(){for(var a=d.length-1;0<=a;--a)h=h||n(e,l(d[a].from,0),l(d[a].to-1),b)});return h})});