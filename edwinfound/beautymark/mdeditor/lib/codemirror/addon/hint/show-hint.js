(function(g){"object"==typeof exports&&"object"==typeof module?g(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],g):g(CodeMirror)})(function(g){function u(a,b,c,f){if(a.async){var d=++v;a(b,function(a){v==d&&f(a)},c)}else f(a(b,c))}function w(a,b){this.cm=a;this.options=this.buildOptions(b);this.widget=this.onClose=null}function A(a,b){function c(a,c){var d;d="string"!=typeof c?function(a){return c(a,b)}:f.hasOwnProperty(c)?f[c]:c;g[a]=d}var f=
{Up:function(){b.moveFocus(-1)},Down:function(){b.moveFocus(1)},PageUp:function(){b.moveFocus(-b.menuSize()+1,!0)},PageDown:function(){b.moveFocus(b.menuSize()-1,!0)},Home:function(){b.setFocus(0)},End:function(){b.setFocus(b.length-1)},Enter:b.pick,Tab:b.pick,Esc:b.close},d=a.options.customKeys,g=d?{}:f;if(d)for(var e in d)d.hasOwnProperty(e)&&c(e,d[e]);if(d=a.options.extraKeys)for(e in d)d.hasOwnProperty(e)&&c(e,d[e]);return g}function x(a,b){for(;b&&b!=a;){if("LI"===b.nodeName.toUpperCase()&&b.parentNode==
a)return b;b=b.parentNode}}function p(a,b){this.completion=a;this.data=b;var c=this,f=a.cm,d=this.hints=document.createElement("ul");d.className="CodeMirror-hints";this.selectedHint=b.selectedHint||0;for(var m=b.list,e=0;e<m.length;++e){var l=d.appendChild(document.createElement("li")),h=m[e],k="CodeMirror-hint"+(e!=this.selectedHint?"":" CodeMirror-hint-active");null!=h.className&&(k=h.className+" "+k);l.className=k;h.render?h.render(l,b,h):l.appendChild(document.createTextNode(h.displayText||("string"==
typeof h?h:h.text)));l.hintId=e}var e=f.cursorCoords(a.options.alignWithWord?b.from:null),n=e.left,q=e.bottom,r=!0;d.style.left=n+"px";d.style.top=q+"px";l=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth);k=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(a.options.container||document.body).appendChild(d);h=d.getBoundingClientRect();if(0<h.bottom-k){var t=h.bottom-h.top;0<e.top-(e.bottom-h.top)-t?(d.style.top=
(q=e.top-t)+"px",r=!1):t>k&&(d.style.height=k-5+"px",d.style.top=(q=e.bottom-h.top)+"px",k=f.getCursor(),b.from.ch!=k.ch&&(e=f.cursorCoords(k),d.style.left=(n=e.left)+"px",h=d.getBoundingClientRect()))}k=h.right-l;0<k&&(h.right-h.left>l&&(d.style.width=l-5+"px",k-=h.right-h.left-l),d.style.left=(n=e.left-k)+"px");f.addKeyMap(this.keyMap=A(a,{moveFocus:function(a,b){c.changeActive(c.selectedHint+a,b)},setFocus:function(a){c.changeActive(a)},menuSize:function(){return c.screenAmount()},length:m.length,
close:function(){a.close()},pick:function(){c.pick()},data:b}));if(a.options.closeOnUnfocus){var y;f.on("blur",this.onBlur=function(){y=setTimeout(function(){a.close()},100)});f.on("focus",this.onFocus=function(){clearTimeout(y)})}var p=f.getScrollInfo();f.on("scroll",this.onScroll=function(){var c=f.getScrollInfo(),b=f.getWrapperElement().getBoundingClientRect(),e=q+p.top-c.top,g=e-(window.pageYOffset||(document.documentElement||document.body).scrollTop);r||(g+=d.offsetHeight);if(g<=b.top||g>=b.bottom)return a.close();
d.style.top=e+"px";d.style.left=n+p.left-c.left+"px"});g.on(d,"dblclick",function(a){(a=x(d,a.target||a.srcElement))&&null!=a.hintId&&(c.changeActive(a.hintId),c.pick())});g.on(d,"click",function(b){(b=x(d,b.target||b.srcElement))&&null!=b.hintId&&(c.changeActive(b.hintId),a.options.completeOnSingleClick&&c.pick())});g.on(d,"mousedown",function(){setTimeout(function(){f.focus()},20)});g.signal(b,"select",m[0],d.firstChild);return!0}g.showHint=function(a,b,c){if(!b)return a.showHint(c);c&&c.async&&
(b.async=!0);b={hint:b};if(c)for(var f in c)b[f]=c[f];return a.showHint(b)};var v=0;g.defineExtension("showHint",function(a){if(!(1<this.listSelections().length||this.somethingSelected())){this.state.completionActive&&this.state.completionActive.close();var b=this.state.completionActive=new w(this,a);if(a=b.options.hint)return g.signal(this,"startCompletion",this),u(a,this,b.options,function(a){b.showHints(a)})}});w.prototype={close:function(){if(this.active()){this.cm.state.completionActive=null;
this.widget&&this.widget.close();if(this.onClose)this.onClose();g.signal(this.cm,"endCompletion",this.cm)}},active:function(){return this.cm.state.completionActive==this},pick:function(a,b){var c=a.list[b];c.hint?c.hint(this.cm,a,c):this.cm.replaceRange("string"==typeof c?c:c.text,c.from||a.from,c.to||a.to,"complete");g.signal(a,"pick",c);this.close()},showHints:function(a){if(!a||!a.list.length||!this.active())return this.close();this.options.completeSingle&&1==a.list.length?this.pick(a,0):this.showWidget(a)},
showWidget:function(a){function b(){l||(l=!0,e.close(),e.cm.off("cursorActivity",d),a&&g.signal(a,"close"))}function c(){l||(g.signal(a,"update"),u(e.options.hint,e.cm,e.options,f))}function f(c){a=c;if(!l){if(!a||!a.list.length)return b();e.widget&&e.widget.close();e.widget=new p(e,a)}}function d(){m&&(r(m),m=0);var a=e.cm.getCursor(),b=e.cm.getLine(a.line);a.line!=k.line||b.length-a.ch!=n-k.ch||a.ch<k.ch||e.cm.somethingSelected()||a.ch&&h.test(b.charAt(a.ch-1))?e.close():(m=q(c),e.widget&&e.widget.close())}
this.widget=new p(this,a);g.signal(a,"shown");var m=0,e=this,l,h=this.options.closeCharacters,k=this.cm.getCursor(),n=this.cm.getLine(k.line).length,q=window.requestAnimationFrame||function(a){return setTimeout(a,1E3/60)},r=window.cancelAnimationFrame||clearTimeout;this.cm.on("cursorActivity",d);this.onClose=b},buildOptions:function(a){var b=this.cm.options.hintOptions,c={},f;for(f in z)c[f]=z[f];if(b)for(f in b)void 0!==b[f]&&(c[f]=b[f]);if(a)for(f in a)void 0!==a[f]&&(c[f]=a[f]);return c}};p.prototype=
{close:function(){if(this.completion.widget==this){this.completion.widget=null;this.hints.parentNode.removeChild(this.hints);this.completion.cm.removeKeyMap(this.keyMap);var a=this.completion.cm;this.completion.options.closeOnUnfocus&&(a.off("blur",this.onBlur),a.off("focus",this.onFocus));a.off("scroll",this.onScroll)}},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(a,b){a>=this.data.list.length?a=b?this.data.list.length-1:0:0>a&&(a=b?0:this.data.list.length-
1);if(this.selectedHint!=a){var c=this.hints.childNodes[this.selectedHint];c.className=c.className.replace(" CodeMirror-hint-active","");c=this.hints.childNodes[this.selectedHint=a];c.className+=" CodeMirror-hint-active";c.offsetTop<this.hints.scrollTop?this.hints.scrollTop=c.offsetTop-3:c.offsetTop+c.offsetHeight>this.hints.scrollTop+this.hints.clientHeight&&(this.hints.scrollTop=c.offsetTop+c.offsetHeight-this.hints.clientHeight+3);g.signal(this.data,"select",this.data.list[this.selectedHint],c)}},
screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}};g.registerHelper("hint","auto",function(a,b){var c=a.getHelpers(a.getCursor(),"hint");if(c.length)for(var f=0;f<c.length;f++){var d=c[f](a,b);if(d&&d.list.length)return d}else if(c=a.getHelper(a.getCursor(),"hintWords")){if(c)return g.hint.fromList(a,{words:c})}else if(g.hint.anyword)return g.hint.anyword(a,b)});g.registerHelper("hint","fromList",function(a,b){for(var c=a.getCursor(),f=a.getTokenAt(c),
d=[],m=0;m<b.words.length;m++){var e=b.words[m];e.slice(0,f.string.length)==f.string&&d.push(e)}if(d.length)return{list:d,from:g.Pos(c.line,f.start),to:g.Pos(c.line,f.end)}});g.commands.autocomplete=g.showHint;var z={hint:g.hint.auto,completeSingle:!0,alignWithWord:!0,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:!0,completeOnSingleClick:!1,container:null,customKeys:null,extraKeys:null};g.defineOption("hintOptions",null)});