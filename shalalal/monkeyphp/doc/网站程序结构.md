##网站程序结构

MonkeyPHP 框架在程序开发设计上主要有以下特点：

 1. 完全面向对象，所有的功能都在对象中实现，除了你在index.php中新建$app外的没有全局变量。  
 2. 完全隐藏框架，你只需把框架当作大家工作多年的编码经验，所以框架是为你的开发提供服务，而不是你要去适应框架。  
 3. 框架所有的功能都绑定在你的app中了，你只需向app获取即可。  

为了实现上面的特点，MonkeyPHP主要从下面几个方面设计。

##一切都源于\Monkey\App

 1. 要构建一个网站程序，主程序必须有一个App类，如 \Macaca\App（关于如何安排这个类的位置在自动加载中介绍过），必须继承自\Monkey\App。  
 2. 你在index.php中$app = new Macaca\App(\_\_DIR\_\_);时就完成整个网站的初始化工作。  
 3. index.php中$app->run();就是开始对用户的请求做处理了。  

##\Monkey\App的工作原理

 1. 通过构造方法初始化程序：

	 1.1. 设置各类常量并保存到app的属性中，主要有：（加星号表示可配置）

    | 常量名 | 解释 |
    |-------|-----|
    | MONKEY_VERSION | 框架版本号 |
    | NAME | 应用名称，如Macaca，于类名相关 |
    | TIME | 请求时间 |
    | DEBUG | 调试模式 |
    | MONKEY_DIR | 框架所在目录，极少用到 |
    | DIR | 应用所在目录 |
    | *TEMP | 临时缓存文件目录 |
    | *FRONT_ROOT_DIR | 前端资源文件所在目录 |
    | INDEX_ROOT_DIR | 前端入口文件所在目录 |
    | FRONT_ROOT_URL | 前端资源文件所在网址 |
    | INDEX_ROOT_URL | 前端入口文件所在网址 |

     1.2. 初始化组件容器，这是App中组件召之即来的动力源泉，但你不必单独使用它。  
     1.3. 接管运行时异常和错误。  
     1.4. 初始化请求和响应组件，为接收请求和发送响应数据做准备。  

 2. $app->run(); 的执行流程（run 方法实际上是另一个方法 dispatching 的别名）：

	 2.1. 从路由组件获得浏览器请求的 路由、控制器 和 执行方法。  
	 2.2. 查找并执行路由hook。关于如何注册路由hook，你可以在应用目录里写好，然后在你的应用类的构造方法里挂载，如\Macaca\App的构造方法里可以这样写：  
	 	
        public function __construct($staticDir) {
            $this->DEBUG = E_ALL; // ^ E_NOTICE ^ E_WARNING;

			//必须先调用父类构造方法完成应用初始化
            parent::__construct($staticDir);
            
            //下面是路由钩子使用示例，实际使用中建议剥离到单独的类中，然后在这里呼叫一下为好。
            //获取hook实例
            $hook= $this->router()->getHook();
            //注册你的hook
            $hook->add(
            	//参数1 挂载路径，这是路由的一部分，/user 匹配/user 和 所有以/user/开头的路由
            	'/user',
                
                //参数2 钩子方法，可以想下面这样是一个匿名闭包，也可以是别的任何回调方法
                function(Monkey\Router\Hook $hook){
                    //todo 你的实际代码
                    //呼叫$hook的next方法是必要，否则将中断钩子链条
                    $hook->next();
                },
                
                //参数3 匹配请求的具体方法，get意思是仅仅响应浏览器的get请求，同理还有post、put等，all则匹配所有请求方法。
                'get'
            );
        }
        
	 2.3. 执行控制器中的 before 前置方法。  
	 2.4. 执行请求的方法，这个是主体。  
	 2.5. 执行控制器中的 after 后置方法。  
        
##如何配置App

 1. 约定一般不变的常量：  
     CHARSET 属性，响应字符集，默认为UTF-8。  
	 TEMP 属性，通常指的是应用目录下的'/temp'子目录。如果非得要改变，请在你的App中覆盖这个属性即可。  
     FRONT_ROOT_DIR 属性，这个仅仅在index.php文件中new时指定。  

 2. 约定一般不变，但需要你自己设置的常量：  
     timezone 属性，默认时区设置，已经设置为 PRC 了。  
     domain 属性，网站所在主域名。默认为空，即使用请求中的域名（危险），因此尽量主动设置，在你的App中覆盖这个属性即可。  

 3. 配置文件中的配置：  
 	3.1. 文件位置。在网站后端目录，即应用目录，下的/data/config.php文件。对于框架自带的组件在/system/vendor/monkey/Globe/data/config.default.php中有个公共默认配置，你可以参照书写，但不可修改它，因为所有网站都要使用这个默认配置。  
 	3.2. 内容全部是组件和你需要自定义的配置，没有一行是框架的，可以说框架是零配置即可运行的。  
 	3.3. 组件的配置将放在组件自身文档中介绍。  

总之，MonkeyPHP尽量减少配置，几乎做到零配置。
 